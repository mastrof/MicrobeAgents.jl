<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Linear concentration ramp · MicrobeAgents.jl</title><meta name="title" content="Linear concentration ramp · MicrobeAgents.jl"/><meta property="og:title" content="Linear concentration ramp · MicrobeAgents.jl"/><meta property="twitter:title" content="Linear concentration ramp · MicrobeAgents.jl"/><meta name="description" content="Documentation for MicrobeAgents.jl."/><meta property="og:description" content="Documentation for MicrobeAgents.jl."/><meta property="twitter:description" content="Documentation for MicrobeAgents.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">MicrobeAgents.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../../introduction/">Introduction</a></li><li><span class="tocitem">Examples</span><ul><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">Random walks</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../RandomWalks/1_randomwalk1D/">1D Random walk</a></li><li><a class="tocitem" href="../../RandomWalks/2_randomwalk2D_motilepatterns/">2D Random walk and motile patterns</a></li><li><a class="tocitem" href="../../RandomWalks/3_randomwalk3D/">3D Random walk</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Chemotaxis</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Linear concentration ramp</a></li><li><a class="tocitem" href="../2_celani_gauss2D/">Noisy chemotaxis towards Gaussian source</a></li><li><a class="tocitem" href="../3_xie_response-function/">Response function (Xie)</a></li><li><a class="tocitem" href="../4_response_functions/">Comparison of chemotactic response functions</a></li><li><a class="tocitem" href="../5_drift_exponential/">Chemotactic drift in exponential ramp with noisy sensing</a></li></ul></li></ul></li><li><span class="tocitem">Validation</span><ul><li><a class="tocitem" href="../../../validation/msd_runtumble/">Mean squared displacement</a></li><li><a class="tocitem" href="../../../validation/velocity_autocorrelations/">Velocity autocorrelation functions</a></li></ul></li><li><a class="tocitem" href="../../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">Chemotaxis</a></li><li class="is-active"><a href>Linear concentration ramp</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Linear concentration ramp</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/mastrof/MicrobeAgents.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/mastrof/MicrobeAgents.jl/blob/main/examples/Chemotaxis/1_linear_ramp.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Linear-concentration-ramp"><a class="docs-heading-anchor" href="#Linear-concentration-ramp">Linear concentration ramp</a><a id="Linear-concentration-ramp-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-concentration-ramp" title="Permalink"></a></h1><p>In this example we will setup an in-silico version of a typical laboratory assay, with chemotactic bacteria moving in a linear concentration ramp, i.e. a concentration field of the form</p><p class="math-container">\[C(x) = C_0 + (C_1 - C_0)\dfrac{x}{L_x}, \qquad x \in [0,L_x].\]</p><p>We will create a closed two-dimensional domain, mimicking a thin microfluidic chamber, with a length of 3 mm along the <code>x</code> direction, and 1.5 mm along the <code>y</code> direction. We will then setup the concentration field along the <code>x</code> direction and observe chemotactic microbes as they drift towards the high-concentration region of the chamber.</p><p>The first thing we have to do is define two functions for the <code>concentration_field</code> and the <code>concentration_gradient</code>. They must take as arguments a single microbe and the model (from which we can access other properties of the system). Of course, for our convenience we can dispatch these functions on whatever arguments we want, as long as they have a method whose signature matches the MicrobeAgents API.</p><p>Importantly, the <code>concentration_field</code> must return a scalar, non-negative value. Since the gradient is a vector quantity, the <code>concentration_gradient</code> should instead return an iterable with length equal to the system dimensionality; a <code>SVector</code> is the recommended choice, but <code>NTuple</code>s, <code>Vector</code>s, etc.. work just fine.</p><p>All the parameters that we need to evaluate the concentration field and gradient, in our case the two concentration values <code>C₀</code> and <code>C₁</code> and the chamber length <code>Lx</code>, should be extracted from the <code>model</code>.</p><pre><code class="language-julia hljs">using MicrobeAgents
using Plots

@inline function concentration_field(microbe, model)
    C₀ = model.C₀
    C₁ = model.C₁
    Lx = first(spacesize(model))
    pos = position(microbe)
    concentration_field(pos,Lx,C₀,C₁)
end
@inline concentration_field(pos,Lx,C₀,C₁) = C₀ + (C₁-C₀)*pos[1]/Lx

@inline function concentration_gradient(microbe, model)
    C₀ = model.C₀
    C₁ = model.C₁
    Lx = first(spacesize(model))
    pos = position(microbe)
    concentration_gradient(pos,Lx,C₀,C₁)
end
@inline concentration_gradient(pos,Lx,C₀,C₁) = SVector{length(pos)}(i==1 ? (C₁-C₀)/Lx : 0.0 for i in eachindex(pos))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">concentration_gradient (generic function with 2 methods)</code></pre><p>Now as usual we define the simulation domain and the integration timestep, but we also define a <code>properties</code> dictionary, which we pass as a keyword argument to <code>StandardABM</code>. This dictionary will contain all the information regarding our concentration field.</p><p>Note that the <code>:C₀</code> and <code>:C₁</code> keys have been defined by us; we could have chosen different names for them. The <code>concentration_field</code> and <code>concentration_gradient</code> functions instead <strong>must</strong> be wrapped into an <code>AbstractChemoattractant</code> type and attached to the <code>:chemoattractant</code> keyword; this is required by MicrobeAgents and assigning these functions to any other key will not produce the desired results. In this example, we define the chemoattractant as a <code>GenericChemoattractant</code>, a default wrapper which takes <code>concentration_field</code> and <code>concentration_gradient</code> as keyword arguments. Notice it also takes the model dimensionality as parameter.</p><p>Finally, to observe chemotaxis, we must use a microbe type for which chemotactic behavior is implemented. If we used the base <code>Microbe</code>, no matter what field we define, we would only observe a random walk since no chemotactic behavior is implemented. The most classic model of chemotaxis is implemented in the <code>BrownBerg</code> type; we will not modify its parameters here and just stick to the default values.</p><pre><code class="language-julia hljs">Lx, Ly = 3000, 1500 # domain size (μm)
periodic = false
space = ContinuousSpace((Lx,Ly); periodic)
Δt = 0.05 # timestep (s)

# model setup
C₀, C₁ = 0.0, 20.0 # μM
properties = Dict(
    :C₀ =&gt; C₀,
    :C₁ =&gt; C₁,
    :chemoattractant =&gt; GenericChemoattractant{2}(;
        concentration_field, concentration_gradient
    )
)
model = StandardABM(BrownBerg{2,2}, space, Δt; properties)
n = 100 # number of microbes
for i in 1:n
    p0 = spacesize(model) ./ 2
    delta = rand(abmrng(model), SVector{2}) .* 10
    pos = p0 .+ delta # random scatter around center
    motility = RunTumble([30.0], 0.67, Isotropic(2); tumble_duration=0.1)
    add_agent!(pos, model; motility)
end
model</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StandardABM with 100 agents of type BrownBerg
 agents container: Dict
 space: continuous space with [3000.0, 1500.0] extent and spacing=75.0
 scheduler: fastest
 properties: chemoattractant, affect!, C₀, C₁, timestep</code></pre><p>Now that the model is created, we just run it as usual, collecting the position of the microbes at each timestep. The visualization is slightly more involved since we want to plot the microbe trajectories on top of the concentration field shown as a heatmap, but there is really no difference from what we have seen in the random walk examples.</p><p>In the figure, we will see that all the microbes drift towards the right, where the concentration of the attractant is higher.</p><pre><code class="language-julia hljs">T = 120 # simulation time (s)
nsteps = round(Int, T/Δt)
adata = [position]
adf, mdf = run!(model, nsteps; adata)

traj = Analysis.adf_to_matrix(adf, :position)
x = first.(traj)
y = last.(traj)

ts = unique(adf.time) .* Δt
lw = eachindex(ts) ./ length(ts) .* 3
xmesh = range(0,Lx,length=100)
ymesh = range(0,Ly,length=100)
xn = @view x[1:4:end,1:15]
yn = @view y[1:4:end,1:15]
c = concentration_field.(Iterators.product(xmesh,ymesh),Lx,C₀,C₁)
heatmap(xmesh, ymesh, c&#39;, cbar=false, c=:bone,
    ratio=1, axis=false, grid=false, xlims=(0,Lx), ylims=(0,Ly)
)
plot!(xn, yn, lab=false, lw=lw, lc=(1:n)&#39;, palette=palette(:thermal,size(xn,2)))
scatter!(xn[end,:], yn[end,:], lab=false, m=:c, mc=1:n, msw=0.5, ms=8)</code></pre><img src="ba615a47.svg" alt="Example block output"/></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../RandomWalks/3_randomwalk3D/">« 3D Random walk</a><a class="docs-footer-nextpage" href="../2_celani_gauss2D/">Noisy chemotaxis towards Gaussian source »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Wednesday 21 January 2026 13:05">Wednesday 21 January 2026</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
